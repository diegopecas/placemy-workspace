<!-- libs/shared/ui-components/src/lib/header/header.component.html -->
<mat-toolbar 
  class="header-toolbar"
  [style.background]="headerBackground()">
  
  <!-- Logo y nombre de la app -->
  <div class="header-logo" (click)="goToDashboard()">
    <img src="/favicon-96x96.png" alt="PlaceMy Logo" class="logo-img" />
    <div class="header-brand">
      <span class="brand-name">PlaceMy</span>
      <span class="brand-tagline">Front House</span>
    </div>
  </div>

  <!-- Selector de establecimiento (solo si hay múltiples) -->
  @if (selectedEstablecimiento()) {
    <div class="establecimiento-selector" 
         [class.clickable]="hasMultipleEstablecimientos()"
         (click)="hasMultipleEstablecimientos() ? onChangeEstablecimiento() : null"
         [matTooltip]="hasMultipleEstablecimientos() ? 'Cambiar establecimiento' : ''">
      <div class="est-avatar">
        @if (selectedEstablecimiento()?.logo_url) {
          <img [src]="selectedEstablecimiento()?.logo_url" [alt]="selectedEstablecimiento()?.nombre" />
        } @else {
          <span class="est-initials">{{ getEstablecimientoInitials(selectedEstablecimiento()?.nombre || '') }}</span>
        }
      </div>
      <div class="est-info">
        <span class="est-name">{{ getEstablecimientoName() }}</span>
        @if (hasMultipleEstablecimientos()) {
          <span class="est-change-hint">
            <mat-icon>swap_horiz</mat-icon>
            Cambiar
          </span>
        }
      </div>
    </div>
  }

  <!-- Spacer -->
  <span class="header-spacer"></span>

  <!-- User info y menú -->
  <div class="header-user">
    <!-- Información del usuario (oculto en móvil) -->
    <div class="user-info">
      <span class="user-name">{{ getUserDisplayName() }}</span>
      <span class="user-role">{{ getUserRole() }}</span>
    </div>

    <!-- Avatar con menú -->
    <button 
      mat-icon-button 
      [matMenuTriggerFor]="userMenu"
      class="user-avatar">
      <div class="avatar-circle" [style.background]="'linear-gradient(135deg, ' + avatarColors().accent + ', ' + avatarColors().primary + ')'">
        {{ getUserInitials() }}
      </div>
    </button>

    <!-- Menú del usuario -->
    <mat-menu #userMenu="matMenu" class="user-menu">
      <!-- Info del usuario en el menú (visible en móvil) -->
      <div class="menu-user-info">
        <div class="menu-avatar" [style.background]="'linear-gradient(135deg, ' + avatarColors().accent + ', ' + avatarColors().primary + ')'">
          {{ getUserInitials() }}
        </div>
        <div class="menu-user-details">
          <p class="menu-user-name">{{ getUserDisplayName() }}</p>
          <p class="menu-user-role">{{ getUserRole() }}</p>
        </div>
      </div>

      <!-- Info del establecimiento en el menú -->
      @if (selectedEstablecimiento()) {
        <div class="menu-establecimiento-info">
          <mat-icon>store</mat-icon>
          <span>{{ getEstablecimientoName() }}</span>
        </div>
      }

      <mat-divider></mat-divider>

      <!-- Opciones del menú -->
      <button mat-menu-item (click)="goToProfile()">
        <mat-icon>person</mat-icon>
        <span>Mi Perfil</span>
      </button>

      <button mat-menu-item (click)="goToDashboard()">
        <mat-icon>dashboard</mat-icon>
        <span>Dashboard</span>
      </button>

      <!-- Opción de cambiar establecimiento (solo si tiene múltiples) -->
      @if (hasMultipleEstablecimientos()) {
        <button mat-menu-item (click)="onChangeEstablecimiento()">
          <mat-icon>swap_horiz</mat-icon>
          <span>Cambiar Establecimiento</span>
        </button>
      }

      <mat-divider></mat-divider>

      <button mat-menu-item (click)="onLogout()" class="logout-button">
        <mat-icon>logout</mat-icon>
        <span>Cerrar Sesión</span>
      </button>
    </mat-menu>
  </div>
</mat-toolbar>
